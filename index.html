<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpaceBook - Find & Book Spaces</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Font (Inter & Lexend) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Apply the font and base styling */
        body {
            font-family: 'Inter', sans-serif;
            /* NEW: Base light background from palette */
            background-color: #FFEDF3; /* Soft Pink */
            color: #1f2937; /* text-gray-800 */
        }
        
        /* Apply Lexend to all headings */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lexend', sans-serif;
            color: #0B1A2B; /* Dark slate text */
            font-weight: 600;
        }

        /* Page transition styling */
        .page {
            display: none; /* Hidden by default */
        }
        .page.active {
            display: block; /* Shown when active */
        }
        
        /* --- NEW Palette Button Styles --- */
        .btn-primary {
            background-color: #0ABAB5; /* NEW: Dark Teal */
            color: white;
            border-radius: 12px; /* Softer corners */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #089a94; /* NEW: Darker Teal */
        }
        .btn-primary:disabled {
            background-color: #6bdad3; /* NEW: Lighter Teal */
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background-color: #56DFCF; /* NEW: Medium Teal */
            color: #0B1A2B; /* NEW: Dark text for contrast */
            border-radius: 12px; /* Softer corners */
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #4acbb9; /* NEW: Darker Medium Teal */
        }

        /* Pill for categories/tags (Kept yellow, it works well) */
        .tag-pill {
            display: inline-block;
            background-color: #FCE38A; 
            color: #0B1A2B;
            padding: 4px 12px;
            border-radius: 9999px; /* Pill shape */
            font-size: 0.75rem; /* 12px */
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Soft shadow for light theme */
        .shadow-soft {
            box-shadow: 0 4px 12px rgba(11, 26, 43, 0.06);
        }

        /* Category button for light theme */
        .category-btn {
            background-color: #ffffff;
            color: #374151; /* gray-700 */
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .category-btn.active {
            background-color: #0ABAB5; /* NEW: Dark Teal */
            color: white;
            border-color: #0ABAB5; /* NEW: Dark Teal */
        }
        
        /* Tab button for light theme */
        .tab-btn {
            color: #4b5563; /* gray-600 */
            border-bottom-color: transparent;
        }
        .tab-btn.active {
            border-bottom-color: #0ABAB5; /* NEW: Dark Teal */
            color: #0ABAB5; /* NEW: Dark Teal */
            font-weight: 600;
        }

        /* Small fade-in for page content */
        .page.active {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Styles for File Upload (Light) --- */
        .file-input { display: none; }
        .preview-box {
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            position: relative;
            background-color: #e5e7eb; /* gray-200 */
            border: 2px dashed #d1d5db; /* gray-300 */
            border-radius: 12px; /* Softer */
            overflow: hidden;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .preview-box:hover { border-color: #0ABAB5; } /* NEW: Dark Teal */
        .preview-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .preview-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.875rem; /* 14px */
            color: #6b7280; /* gray-500 */
            text-align: center;
            font-weight: 500;
        }
        
        /* --- Mobile Menu Styles (Light) --- */
        #mobile-menu {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            transform: translateX(100%);
            box-shadow: none;
            background-color: #ffffff;
            border-left: 1px solid #e5e7eb; /* gray-200 */
        }
        #mobile-menu.open {
            transform: translateX(0);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
        }
        #mobile-menu-overlay {
            transition: opacity 0.3s ease-in-out;
        }

        /* --- Card Image Slider --- */
        .card-image-container {
            position: relative;
            width: 100%;
            height: 192px; /* h-48 */
            overflow: hidden; /* This clips the other images */
        }
        .card-image-wrapper {
            display: flex;
            height: 100%;
        }
        .card-image-slide {
            width: 100%;
            height: 100%;
            object-fit: cover;
            flex-shrink: 0; /* Prevents images from shrinking */
        }
        
        /* --- Light Mode Form Inputs --- */
        input, select, textarea {
            background-color: #ffffff !important; 
            border-color: #d1d5db !important; /* gray-300 */
            color: #111827 !important; /* gray-900 */
            border-radius: 12px !important; /* Softer */
        }
        input:focus, select:focus, textarea:focus {
            border-color: #0ABAB5 !important; /* NEW: Dark Teal */
            ring: 1;
            ring-color: #0ABAB5 !important; /* NEW: Dark Teal */
        }
        input::placeholder, textarea::placeholder {
            color: #6b7280 !important; /* gray-500 */
        }
        
        /* Fix select arrow for light mode */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
        }

        /* Success/Error messages (Light) */
        .bg-green-100 {
            background-color: #dcfce7 !important; /* green-100 */
            color: #166534 !important; /* green-800 */
        }
        .bg-red-100 {
            background-color: #fee2e2 !important; /* red-100 */
            color: #991b1b !important; /* red-800 */
        }
    </style>
</head>
<!-- Base classes for light theme, removed bg-gray-50 to use style tag -->
<body class="antialiased text-gray-800">

    <!-- Header / Navigation Bar -->
    <header class="bg-white shadow-soft sticky top-0 z-20 border-b border-gray-200">
        <nav class="max-w-5xl mx-auto p-4 flex justify-between items-center">
            <!-- NEW: Logo color changed to dark teal -->
            <a href="#" onclick="showPage('home')" class="text-2xl font-bold" style="color: #0ABAB5;">SpaceBook</a>
            
            <!-- Desktop Menu -->
            <div class="hidden sm:flex items-center space-x-2">
                <!-- Logged Out Links -->
                <div id="auth-links-desktop" class="space-x-2">
                    <a href="#" onclick="showPage('home')" class="text-gray-700 hover:text-teal-600 px-3 py-2 rounded-lg text-sm font-semibold">Explore</a>
                    <a href="#" onclick="showPage('host')" class="text-gray-700 hover:text-teal-600 px-3 py-2 rounded-lg text-sm font-semibold">List Your Space</a>
                    <a href="#" onclick="showPage('login')" class="btn-secondary px-4 py-2 text-sm font-semibold">Log In</a>
                    <a href="#" onclick="showPage('signup')" class="btn-primary px-4 py-2 text-sm">Sign Up</a>
                </div>

                <!-- Logged In Menu -->
                <div id="user-menu-desktop" class="hidden items-center space-x-2">
                    <a href="#" onclick="showPage('home')" class="text-gray-700 hover:text-teal-600 px-3 py-2 rounded-lg text-sm font-semibold">Explore</a>
                    <a href="#" onclick="showPage('host')" class="btn-primary px-4 py-2 text-sm">List Your Space</a>
                    <a href="#" onclick="showPage('account')" class="text-gray-700 hover:text-teal-600 px-3 py-2 rounded-lg text-sm font-semibold">My Account</a>
                    <a href="#" onclick="handleLogout()" class="btn-secondary px-4 py-2 text-sm font-semibold">Log Out</a>
                </div>
            </div>
            
            <!-- Mobile Hamburger Button -->
            <div class="sm:hidden">
                <button onclick="toggleMobileMenu()" class="p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </nav>
    </header>
    
    <!-- Mobile Menu -->
    <!-- Overlay -->
    <div id="mobile-menu-overlay" onclick="toggleMobileMenu()" class="hidden fixed inset-0 bg-black bg-opacity-50 z-20"></div>
    <!-- Menu Panel (Light) -->
    <div id="mobile-menu" class="fixed top-0 right-0 w-64 h-full bg-white z-30 p-6 space-y-4 border-l border-gray-200">
        <a href="#" onclick="mobileMenuLink('home')" class="block py-2 text-lg font-semibold text-gray-700 hover:text-teal-600">Explore</a>
        <a href="#" onclick="mobileMenuLink('host')" class="block py-2 text-lg font-semibold text-gray-700 hover:text-teal-600">List Your Space</a>
        
        <!-- Logged Out Mobile Links -->
        <div id="auth-links-mobile" class="space-y-4 pt-4 border-t border-gray-200">
            <a href="#" onclick="mobileMenuLink('login')" class="block w-full text-center btn-secondary py-2 text-base font-semibold">Log In</a>
            <a href="#" onclick="mobileMenuLink('signup')" class="block w-full text-center btn-primary py-2 text-base">Sign Up</a>
        </div>
        
        <!-- Logged In Mobile Links -->
        <div id="user-menu-mobile" class="hidden space-y-4 pt-4 border-t border-gray-200">
            <a href="#" onclick="mobileMenuLink('account')" class="block py-2 text-lg font-semibold text-gray-700 hover:text-teal-600">My Account</a>
            <a href="#" onclick="handleLogout()" class="block w-full text-center btn-secondary py-2 text-base font-semibold">Log Out</a>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="max-w-5xl mx-auto p-4 md:p-6 pb-24">

        <!-- 1. Home Page -->
        <section id="page-home" class="page active">
            <div class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold mb-2">Find your perfect space</h1>
                <p class="text-base sm:text-lg text-gray-600">For parties, jam sessions, sports, and more.</p>
            </div>
            
            <!-- Search Bar -->
            <div class="mb-6">
                <input type="text" id="searchInput" onkeyup="renderHomePage()" placeholder="Search by name, location, or type..." class="w-full p-4 border rounded-xl shadow-sm focus:outline-none focus:ring-2 text-base">
            </div>

            <!-- Category Buttons -->
            <div id="category-buttons-container" class="flex space-x-2 mb-8 overflow-x-auto pb-2">
                <!-- Buttons will be injected here by JS -->
            </div>

            <!-- Spaces List -->
            <div id="spaces-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Space cards will be injected here by JavaScript -->
            </div>
        </section>

        <!-- 2. Space Details Page -->
        <section id="page-details" class="page">
            <button onclick="showPage('home')" class="mb-4 text-teal-600 hover:text-teal-700 hover:underline font-semibold">&larr; Back to results</button>
            <div id="details-content" class="bg-white rounded-xl shadow-soft overflow-hidden">
                <!-- Details content will be injected here by JavaScript -->
            </div>
            <!-- Sticky Booking Button on Mobile -->
            <div id="sticky-book-button" class="md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 z-10 shadow-inner">
                 <!-- This button's onclick will be set by renderDetailsPage -->
            </div>
        </section>

        <!-- 3. Booking Page -->
        <section id="page-book" class="page">
            <button onclick="showPage('details', currentSpaceId)" class="mb-4 text-teal-600 hover:text-teal-700 hover:underline font-semibold">&larr; Back to details</button>
            
            <!-- Login Wall -->
            <div id="book-login-wall" class="hidden text-center bg-white rounded-xl shadow-soft p-8">
                <h2 class="text-2xl font-bold mb-4">Please log in to book</h2>
                <p class="text-gray-600 mb-6">You need to be logged in to book a space.</p>
                <button onclick="showPage('login')" class="btn-primary px-6 py-3 text-lg">Log In or Sign Up</button>
            </div>
            
            <!-- Booking Form -->
            <div id="book-content-wrapper">
                <div id="book-content" class="bg-white rounded-xl shadow-soft p-6 md:p-8">
                    <!-- Booking form will be injected here by JavaScript -->
                </div>
                <!-- Success/Error Messages -->
                <div id="booking-message-container" class="mt-6">
                    <div id="success-message" class="hidden p-4 bg-green-100 text-green-800 rounded-xl shadow-soft">
                        <h3 class="font-bold text-lg">âœ… Booking Confirmed!</h3>
                        <p>Your space is booked. You can view your bookings in "My Account".</p>
                    </div>
                    <div id="booking-error-message" class="hidden p-4 bg-red-100 text-red-800 rounded-xl shadow-soft">
                        <!-- Error text injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Host Page (List Your Space) -->
        <section id="page-host" class="page">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6">List Your Space</h2>
            
            <!-- Login Wall -->
            <div id="host-login-wall" class="hidden text-center bg-white rounded-xl shadow-soft p-8">
                <h2 class="text-2xl font-bold mb-4">Please log in to list a space</h2>
                <p class="text-gray-600 mb-6">You need an account to become a host.</p>
                <button onclick="showPage('login')" class="btn-primary px-6 py-3 text-lg">Log In or Sign Up</button>
            </div>
            
            <!-- Host Form -->
            <form id="host-form" onsubmit="addSpace(event)" class="bg-white rounded-xl shadow-soft p-6 md:p-8 space-y-6">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Space Name</label>
                        <input type="text" id="name" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <div>
                        <label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location / City</label>
                        <input type="text" id="location" placeholder="e.g., Mangalore, India" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="type" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                        <select id="type" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2" onchange="checkOtherType(event)">
                            <option value="Party">Party</option>
                            <option value="Jam">Jam</option>
                            <option value="Sports">Sports</option>
                            <option value="Other">Other (Please specify)</option>
                        </select>
                        <div id="other-type-wrapper" class="hidden mt-4">
                            <label for="other-type" class="block text-sm font-medium text-gray-700 mb-1">Custom Type</label>
                            <input type="text" id="other-type" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                        </div>
                    </div>
                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700 mb-1">Price per Hour (â‚¹)</label>
                        <input type="number" id="price" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                </div>

                <div>
                    <label for="desc" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="desc" rows="4" placeholder="Describe your space, amenities, and rules." class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2"></textarea>
                </div>

                <div>
                    <label for="amenities" class="block text-sm font-medium text-gray-700 mb-1">Amenities</label>
                    <input type="text" id="amenities" placeholder="e.g., Wi-Fi, AC, Parking, Sound System" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    <p class="text-xs text-gray-500 mt-1">Enter amenities separated by commas.</p>
                </div>
                
                <!-- Image Upload Section -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload Photos (Up to 5)</label>
                    <p class="text-xs text-gray-500 mb-4">Click a box to upload. The first image will be the main one.</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
                        <!-- Image 1 -->
                        <div>
                            <label for="image1" class="cursor-pointer">
                                <div class="preview-box">
                                    <img id="preview1" src="" class="preview-img">
                                    <span id="text-preview1" class="preview-text">Main Image</span>
                                </div>
                            </label>
                            <input type="file" id="image1" accept="image/*" class="file-input" onchange="previewImage(event, 'preview1', 'text-preview1')">
                        </div>
                        <!-- Image 2 -->
                        <div>
                            <label for="image2" class="cursor-pointer">
                                <div class="preview-box">
                                    <img id="preview2" src="" class="preview-img">
                                    <span id="text-preview2" class="preview-text">+ Upload</span>
                                </div>
                            </label>
                            <input type="file" id="image2" accept="image/*" class="file-input" onchange="previewImage(event, 'preview2', 'text-preview2')">
                        </div>
                        <!-- Image 3 -->
                        <div>
                            <label for="image3" class="cursor-pointer">
                                <div class="preview-box">
                                    <img id="preview3" src="" class="preview-img">
                                    <span id="text-preview3" class="preview-text">+ Upload</span>
                                </div>
                            </label>
                            <input type="file" id="image3" accept="image/*" class="file-input" onchange="previewImage(event, 'preview3', 'text-preview3')">
                        </div>
                        <!-- Image 4 -->
                        <div>
                            <label for="image4" class="cursor-pointer">
                                <div class="preview-box">
                                    <img id="preview4" src="" class="preview-img">
                                    <span id="text-preview4" class="preview-text">+ Upload</span>
                                </div>
                            </label>
                            <input type="file" id="image4" accept="image/*" class="file-input" onchange="previewImage(event, 'preview4', 'text-preview4')">
                        </div>
                        <!-- Image 5 -->
                        <div>
                            <label for="image5" class="cursor-pointer">
                                <div class="preview-box">
                                    <img id="preview5" src="" class="preview-img">
                                    <span id="text-preview5" class="preview-text">+ Upload</span>
                                </div>
                            </label>
                            <input type="file" id="image5" accept="image/*" class="file-input" onchange="previewImage(event, 'preview5', 'text-preview5')">
                        </div>
                    </div>
                </div>
                
                <button type="submit" id="add-space-btn" class="w-full btn-primary font-semibold py-3 px-4 rounded-xl shadow-md text-base">Add Space</button>
            </form>
            <!-- Host Success Message -->
            <p id="hostMsg" class="hidden mt-6 p-4 rounded-xl shadow-soft font-medium"></p>
        </section>
        
        <!-- 5. Log In Page -->
        <section id="page-login" class="page">
            <div class="max-w-md mx-auto bg-white rounded-xl shadow-soft p-8">
                <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center">Log In</h2>
                <form id="login-form" onsubmit="handleLogin(event)" class="space-y-6">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="login-email" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <p id="login-error" class="text-red-600 text-sm hidden"></p>
                    <button type="submit" class="w-full btn-primary font-semibold py-3 px-4 rounded-xl shadow-md text-base">Log In</button>
                </form>
                <p class="text-center text-gray-600 mt-6">
                    Don't have an account? <a href="#" onclick="showPage('signup')" class="text-teal-600 font-semibold hover:underline">Sign Up</a>
                </p>
            </div>
        </section>
        
        <!-- 6. Sign Up Page -->
        <section id="page-signup" class="page">
            <div class="max-w-md mx-auto bg-white rounded-xl shadow-soft p-8">
                <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center">Create Account</h2>
                <form id="signup-form" onsubmit="handleSignup(event)" class="space-y-6">
                    <div>
                        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="signup-name" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signup-email" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</glabel>
                        <input type="password" id="signup-password" required class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    <p id="signup-error" class="text-red-600 text-sm hidden"></p>
                    <button type="submit" class="w-full btn-primary font-semibold py-3 px-4 rounded-xl shadow-md text-base">Create Account</button>
                </form>
                <p class="text-center text-gray-600 mt-6">
                    Already have an account? <a href="#" onclick="showPage('login')" class="text-teal-600 font-semibold hover:underline">Log In</a>
                </p>
            </div>
        </section>
        
        <!-- 7. My Account Page -->
        <section id="page-account" class="page">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6" id="account-welcome">Welcome!</h2>
            
            <!-- Tabs -->
            <div class="mb-6 border-b border-gray-300">
                <!-- Mobile-friendly tab container -->
                <nav class="flex -mb-px space-x-2 sm:space-x-6">
                    <button id="tab-btn-bookings" onclick="showAccountTab('bookings')" class="tab-btn active text-center flex-1 sm:flex-none py-3 px-1 hover:text-teal-600 border-b-2 transition-all text-sm sm:text-base">My Bookings</button>
                    <button id="tab-btn-spaces" onclick="showAccountTab('spaces')" class="tab-btn text-center flex-1 sm:flex-none py-3 px-1 hover:text-teal-600 border-b-2 transition-all text-sm sm:text-base">My Spaces</button>
                </nav>
            </div>
            
            <!-- Tab Content: My Bookings -->
            <div id="tab-content-bookings" class="account-tab-content space-y-6">
                <!-- Bookings injected here -->
            </div>
            
            <!-- Tab Content: My Spaces -->
            <div id="tab-content-spaces" class="account-tab-content hidden space-y-6">
                <!-- Hosted spaces injected here -->
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center p-6 mt-10 border-t border-gray-200 bg-white">
        <p class="text-sm text-gray-500">&copy; 2025 SpaceBook. All rights reserved.</p>
    </footer>

    <script>
        // --- DATABASE ---
        
        // User data (in a real app, this would be in a database)
        let users = [
                 { id: 1, name: "Alice Smith", email: "alice@example.com", password: "password123" }
        ];
        
        // Spaces data
        let spaces = [
            {
                id: 1,
                hostId: 1,
                hostName: "Alice Smith",
                name: "Cozy Rooftop Party Space",
                type: "Party",
                price: 400,
                location: "Mangalore, India",
                images: [
                    "https://picsum.photos/seed/rooftop1/600/400",
                    "https://picsum.photos/seed/party2/600/400",
                    "https://picsum.photos/seed/view3/600/400",
                    "https://picsum.photos/seed/decor4/600/400",
                    "https://picsum.photos/seed/nightlife5/600/400"
                ],
                description: "Spacious rooftop for 10-20 people with great city views, lights, and a basic sound system. Perfect for evening parties.",
                amenities: ["Sound Allowed", "Wi-Fi Available", "Restroom", "City View", "Parking"],
                rating: 4.8, 
                reviewCount: 23, 
                reviews: [ 
                    { author: "Rohan K.", rating: 5, comment: "Amazing place for a small party! The view is fantastic." },
                    { author: "Priya G.", rating: 4, comment: "Good setup, but parking was a bit hard to find." }
                ]
            },
            {
                id: 2,
                hostId: 1,
                hostName: "Alice Smith",
                name: "Pro Jam Studio",
                type: "Jam",
                price: 300,
                location: "Bangalore, India",
                images: [
                    "https://picsum.photos/seed/studio1/600/400",
                    "https://picsum.photos/seed/drums2/600/400",
                    "https://picsum.photos/seed/amps3/600/400",
                    "https://picsum.photos/seed/mixing4/600/400",
                    "https://picsum.photos/seed/guitar5/600/400"
                ],
                description: "Fully soundproofed jam room with a 5-piece drum kit, bass amp, and guitar amp. Bring your own instruments.",
                amenities: ["Soundproof", "Drum Kit", "Amplifiers", "AC", "Microphones"],
                rating: 4.5, 
                reviewCount: 12, 
                reviews: [ 
                    { author: "The Bandits", rating: 5, comment: "Great amps and a solid drum kit. Our go-to practice spot." },
                    { author: "Sarah J.", rating: 4, comment: "Room is great, but the mics could be better." }
                ]
            },
            {
                id: 3,
                hostId: 1,
                hostName: "Alice Smith",
                name: "City Turf Court",
                type: "Sports",
                price: 500,
                location: "Mangalore, India",
                images: [
                    "https://picsum.photos/seed/turf1/600/400",
                    "https://picsum.photos/seed/football2/600/400",
                    "https://picsum.photos/seed/lights3/600/400",
                    "https://picsum.photos/seed/goal4/600/400",
                    "https://picsum.photos/seed/sport5/600/400"
                ],
                description: "5-a-side artificial turf football court. Well-lit for night games. Booking includes bibs and a ball.",
                amenities: ["Floodlights", "Drinking Water", "Parking", "Bibs & Ball", "Changing Room"],
                rating: 4.2, 
                reviewCount: 8, 
                reviews: [ 
                    { author: "Vikram", rating: 5, comment: "Excellent turf quality and good lights." },
                    { author: "Team Eagles", rating: 4, comment: "Fun game, but the changing room is a bit small." },
                    { author: "Aditya", rating: 3, comment: "Ball provided was old. Please replace it." }
                ]
            }
        ];
        
        // Bookings data
        let bookings = [];

        // --- STATE ---
        let currentFilter = 'all';
        let currentSpaceId = null;
        let currentUser = null; // { id, name, email }
        let cardImageSliderInterval = null; // Interval for card sliders

        // --- CONSTANTS (for star ratings) ---
        const STAR_FILLED_SVG = `<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
        const STAR_EMPTY_SVG = `<svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
        
        // Emoji map for categories
        const TYPE_EMOJIS = {
            'Party': 'ðŸŽ‰',
            'Jam': 'ðŸŽ¸',
            'Sports': 'ðŸ€',
            'default': 'ðŸ·ï¸'
        };


        // --- MOBILE MENU ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            menu.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }
        
        function mobileMenuLink(pageId, context) {
            showPage(pageId, context);
            toggleMobileMenu();
        }

        // --- NAVIGATION ---
        function showPage(pageId, context) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`page-${pageId}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update Auth State in Header (Desktop and Mobile)
            if (currentUser) {
                // Desktop
                document.getElementById('auth-links-desktop').classList.add('hidden');
                document.getElementById('user-menu-desktop').classList.remove('hidden');
                document.getElementById('user-menu-desktop').classList.add('flex');
                // Mobile
                document.getElementById('auth-links-mobile').classList.add('hidden');
                document.getElementById('user-menu-mobile').classList.remove('hidden');
            } else {
                // Desktop
                document.getElementById('auth-links-desktop').classList.remove('hidden');
                document.getElementById('user-menu-desktop').classList.add('hidden');
                document.getElementById('user-menu-desktop').classList.remove('flex');
                // Mobile
                document.getElementById('auth-links-mobile').classList.remove('hidden');
                document.getElementById('user-menu-mobile').classList.add('hidden');
            }

            // Reset messages
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('booking-error-message').classList.add('hidden');
            document.getElementById('hostMsg').classList.add('hidden');
            document.getElementById('login-error').classList.add('hidden');
            document.getElementById('signup-error').classList.add('hidden');
            
            // Hide sticky button by default
            document.getElementById('sticky-book-button').classList.add('hidden');

            // Stop/Start card image slider
            if (pageId === 'home') {
                renderHomePage(); // This will re-render and sliders will be picked up
                startCardImageSliders();
            } else {
                stopCardImageSliders();
            }

            if (pageId === 'details') {
                currentSpaceId = context;
                renderDetailsPage(currentSpaceId);
                // Show sticky button on details page
                document.getElementById('sticky-book-button').classList.remove('hidden');
            } else if (pageId === 'book') {
                currentSpaceId = context;
                // Check login status
                if (currentUser) {
                    document.getElementById('book-login-wall').classList.add('hidden');
                    document.getElementById('book-content-wrapper').classList.remove('hidden');
                    renderBookPage(currentSpaceId);
                } else {
                    document.getElementById('book-login-wall').classList.remove('hidden');
                    document.getElementById('book-content-wrapper').classList.add('hidden');
                }
            } else if (pageId === 'host') {
                // Check login status
                if (currentUser) {
                    document.getElementById('host-login-wall').classList.add('hidden');
                    document.getElementById('host-form').classList.remove('hidden');
                    // Reset host form and previews
                    document.getElementById('host-form').reset();
                    document.getElementById('other-type-wrapper').classList.add('hidden');
                    document.getElementById('other-type').value = '';
                    
                    for (let i = 1; i <= 5; i++) {
                        const preview = document.getElementById(`preview${i}`);
                        const textPreview = document.getElementById(`text-preview${i}`);
                        if (preview) preview.src = "";
                        if (textPreview) textPreview.classList.remove('hidden');
                    }
                } else {
                    document.getElementById('host-login-wall').classList.remove('hidden');
                    document.getElementById('host-form').classList.add('hidden');
                }
            } else if (pageId === 'account') {
                renderAccountPage();
            } else if (pageId === 'login') {
                document.getElementById('login-form').reset();
            } else if (pageId === 'signup') {
                document.getElementById('signup-form').reset();
            }
            
            window.scrollTo(0, 0);
        }

        // --- AUTH FUNCTIONS ---
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = { id: user.id, name: user.name, email: user.email };
                showPage('home');
            } else {
                errorEl.innerText = "Invalid email or password.";
                errorEl.classList.remove('hidden');
            }
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const errorEl = document.getElementById('signup-error');

            if (users.find(u => u.email === email)) {
                errorEl.innerText = "An account with this email already exists.";
                errorEl.classList.remove('hidden');
                return;
            }

            const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
            const newUser = { id: newId, name, email, password };
            users.push(newUser);
            
            currentUser = { id: newUser.id, name: newUser.name, email: newUser.email };
            showPage('home');
        }
        
        function handleLogout() {
            currentUser = null;
            if (document.getElementById('mobile-menu').classList.contains('open')) {
                toggleMobileMenu();
            }
            showPage('home');
        }

        // --- IMAGE PREVIEW ---
        function previewImage(event, previewId, textPreviewId) {
            const input = event.target;
            const preview = document.getElementById(previewId);
            const textPreview = document.getElementById(textPreviewId);

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result; 
                    textPreview.classList.add('hidden');
                }
                
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = "";
                textPreview.classList.remove('hidden');
            }
        }
        
        // --- HELPERS ---
        function generateStarsHTML(rating) {
            let html = '<div class="flex items-center">';
            const roundedRating = Math.round(rating); 
            for (let i = 1; i <= 5; i++) {
                html += (i <= roundedRating) ? STAR_FILLED_SVG : STAR_EMPTY_SVG;
            }
            html += '</div>';
            return html;
        }

        // --- CARD IMAGE SLIDER FUNCTIONS ---
        function startCardImageSliders() {
            stopCardImageSliders();
            
            cardImageSliderInterval = setInterval(() => {
                const cards = document.querySelectorAll('.space-card');
                cards.forEach(card => {
                    try {
                        const images = JSON.parse(card.dataset.images);
                        if (images.length <= 1) return; 

                        let currentIndex = parseInt(card.dataset.currentIndex || 0);
                        const wrapper = card.querySelector('.card-image-wrapper');
                        if (!wrapper) return;

                        currentIndex++;
                        
                        wrapper.style.transition = 'transform 0.7s ease-in-out'; // Slightly faster slide
                        wrapper.style.transform = `translateX(${-currentIndex * 100}%)`;
                        
                        if (currentIndex === images.length) {
                            setTimeout(() => {
                                wrapper.style.transition = 'none'; 
                                wrapper.style.transform = 'translateX(0%)'; 
                                card.dataset.currentIndex = 0; 
                            }, 700); // Must match the transition duration
                        } else {
                            card.dataset.currentIndex = currentIndex;
                        }
                    } catch (e) {
                        console.error("Error parsing images for card slider:", e);
                    }
                });
            }, 3000); // Change image every 3 seconds
        }

        function stopCardImageSliders() {
            if (cardImageSliderInterval) {
                clearInterval(cardImageSliderInterval);
                cardImageSliderInterval = null;
            }
        }

        // --- DYNAMIC CATEGORY FILTERS ---
        function renderCategoryFilters() {
            const container = document.getElementById('category-buttons-container');
            if (!container) return;

            const allTypes = [...new Set(spaces.map(s => s.type))];
            
            container.innerHTML = ''; // Clear existing
            
            container.innerHTML += `
                <button onclick="filterByType('all', event)" class="category-btn ${currentFilter === 'all' ? 'active' : ''} flex-shrink-0 px-5 py-2 rounded-full shadow-sm text-sm font-semibold transition-colors duration-200">All</button>
            `;
            
            allTypes.forEach(type => {
                const emoji = TYPE_EMOJIS[type] || TYPE_EMOJIS['default'];
                container.innerHTML += `
                    <button onclick="filterByType('${type}', event)" class="category-btn ${currentFilter === type ? 'active' : ''} flex-shrink-0 px-5 py-2 rounded-full shadow-sm text-sm font-semibold transition-colors duration-200">${type} ${emoji}</button>
                `;
            });
        }


        // --- PAGE RENDERING ---

        // 1. Render Home Page
        function renderHomePage() {
            renderCategoryFilters();

            const listElement = document.getElementById('spaces-list');
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            listElement.innerHTML = ''; 

            const filteredSpaces = spaces.filter(space => {
                const matchesSearch = space.name.toLowerCase().includes(searchInput) || 
                                      space.type.toLowerCase().includes(searchInput) ||
                                      space.location.toLowerCase().includes(searchInput);
                const matchesFilter = (currentFilter === 'all') || (space.type === currentFilter);
                return matchesSearch && matchesFilter;
            });

            if (filteredSpaces.length === 0) {
                listElement.innerHTML = `<p class="text-gray-600 col-span-full text-center py-10">No spaces found matching your criteria. Try adjusting your search or filters.</p>`;
                return;
            }

            filteredSpaces.forEach(space => {
                const imageUrl = space.images && space.images.length > 0 ? space.images[0] : 'https://picsum.photos/seed/default/600/400';
                const imagesData = JSON.stringify(space.images);
                
                listElement.innerHTML += `
                    <div class="space-card bg-white rounded-xl shadow-soft overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1" 
                         data-images='${imagesData}' 
                         data-current-index="0">
                        <div class="card-image-container">
                            <div class="card-image-wrapper">
                                ${space.images.map(imgSrc => `
                                    <img src="${imgSrc}" alt="${space.name}" class="card-image-slide">
                                `).join('')}
                                <!-- Clone of first image -->
                                <img src="${imageUrl}" alt="${space.name}" class="card-image-slide">
                            </div>
                        </div>
                        <div class="p-5">
                            <div class="flex justify-between items-center mb-2">
                                <span class="tag-pill">${space.type}</span>
                                <p class="text-lg font-bold text-teal-600">â‚¹${space.price}<span class="text-sm font-normal text-gray-600">/hr</span></p>
                            </div>
                            <h3 class="text-xl font-bold mt-2 mb-1 truncate">${space.name}</h3>
                            <p class="text-sm text-gray-500 mb-2">${space.location}</p>
                            <div class="flex items-center mb-4">
                                ${STAR_FILLED_SVG}
                                <span class="text-gray-700 font-semibold ml-1">${space.rating.toFixed(1)}</span>
                                <span class="text-gray-500 text-sm ml-2">(${space.reviewCount} reviews)</span>
                            </div>
                            <button onclick="showPage('details', ${space.id})" class="w-full btn-primary font-semibold py-3 px-4 rounded-xl">
                                View Details
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function filterByType(type, event) {
            currentFilter = type;
            // The renderHomePage function will handle updating the 'active' class
            renderHomePage();
        }

        // 2. Render Details Page
        function renderDetailsPage(spaceId) {
            const space = spaces.find(s => s.id === spaceId);
            if (!space) {
                showPage('home');
                return;
            }

            const contentElement = document.getElementById('details-content');
            
            const amenitiesHTML = space.amenities.map(item => `
                <li class="flex items-center space-x-3">
                    <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                    <span class="text-gray-700">${item}</span>
                </li>
            `).join('');
            
            const thumbnailHTML = space.images.map((img, index) => `
                <img src="${img}" alt="Thumbnail ${index + 1}" 
                     onclick="changeMainImage(${space.id}, ${index})" 
                     class="h-16 w-16 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-teal-500 transition-all ${index === 0 ? 'border-teal-500' : 'border-gray-200'}"
                     id="thumb-${space.id}-${index}">
            `).join('');
            
            const mainImage = space.images && space.images.length > 0 ? space.images[0] : 'https://picsum.photos/seed/default/600/400';

            const reviewsHTML = space.reviews.map(review => `
                <div class="py-4 border-b border-gray-200 last:border-b-0">
                    <div class="flex justify-between items-center mb-1">
                        <h4 class="font-semibold text-gray-800">${review.author}</h4>
                        ${generateStarsHTML(review.rating)}
                    </div>
                    <p class="text-gray-600">${review.comment}</p>
                </div>
            `).join('');

            contentElement.innerHTML = `
                <div class="md:grid md:grid-cols-2 md:gap-8">
                    <!-- Image Gallery -->
                    <div class="p-4 md:p-0">
                        <img src="${mainImage}" alt="${space.name}" id="main-image-${space.id}" class="w-full h-64 md:h-96 object-cover rounded-lg shadow-md mb-4 bg-gray-200">
                        <div class="flex space-x-2 overflow-x-auto pb-2">
                            ${thumbnailHTML}
                        </div>
                    </div>
                    
                    <!-- Details Text -->
                    <div class="p-6 md:p-8">
                        <span class="tag-pill mb-3">${space.type}</span>
                        <h2 class="text-2xl sm:text-3xl font-bold">${space.name}</h2>
                        
                        <div class="flex items-center mt-2 mb-2">
                            ${STAR_FILLED_SVG}
                            <span class="text-gray-700 font-semibold ml-1 text-lg">${space.rating.toFixed(1)}</span>
                            <span class="text-gray-500 text-base ml-2">(${space.reviewCount} reviews)</span>
                        </div>
                        
                        <p class="text-md text-gray-600 mb-4">${space.location}</p>
                        <p class="text-sm text-gray-500 mb-4">Hosted by: <span class="font-medium text-gray-700">${space.hostName || 'A SpaceBook Host'}</span></p>
                        
                        <p class="text-3xl font-bold text-teal-600 mb-6">â‚¹${space.price}<span class="text-lg font-normal text-gray-600">/hour</span></p>
                        
                        <p class="text-gray-700 text-base mb-6">${space.description}</p>
                        
                        <h3 class="text-xl font-bold mb-3">Amenities</h3>
                        <ul class="space-y-3">
                            ${amenitiesHTML}
                        </ul>

                        <h3 class="text-xl font-bold mt-8 mb-3">Reviews (${space.reviewCount})</h3>
                        <div class="space-y-4 mb-6">
                            ${space.reviews.length > 0 ? reviewsHTML : '<p class="text-gray-600">No reviews for this space yet.</p>'}
                        </div>
                        
                        <button onclick="showPage('book', ${space.id})" class="hidden md:block w-full btn-primary font-bold py-3 px-6 rounded-lg text-lg shadow-md">
                            Book Now
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('sticky-book-button').innerHTML = `
                <button onclick="showPage('book', ${space.id})" class="w-full btn-primary font-bold py-4 px-6 rounded-lg text-lg shadow-md">
                    Book Now (â‚¹${space.price}/hr)
                </button>
            `;
        }
        
        function changeMainImage(spaceId, imageIndex) {
            const space = spaces.find(s => s.id === spaceId);
            if (!space || !space.images[imageIndex]) return;

            document.getElementById(`main-image-${spaceId}`).src = space.images[imageIndex];
            
            space.images.forEach((img, index) => {
                const thumb = document.getElementById(`thumb-${spaceId}-${index}`);
                if (thumb) {
                    thumb.classList.remove('border-teal-500', 'border-gray-200');
                    if(index === imageIndex) {
                        thumb.classList.add('border-teal-500');
                    } else {
                        thumb.classList.add('border-gray-200');
                    }
                }
            });
        }

        // 3. Render Booking Page
        function renderBookPage(spaceId) {
            const space = spaces.find(s => s.id === spaceId);
            if (!space) {
                showPage('home');
                return;
            }

            const contentElement = document.getElementById('book-content');
            const today = new Date().toISOString().split('T')[0];

            contentElement.innerHTML = `
                <h2 class="text-2xl font-bold mb-1">Book: ${space.name}</h2>
                <p class="text-lg text-gray-700 mb-6">Price: â‚¹${space.price}/hour</p>
                
                <form id="booking-form" class="space-y-4">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                        <input type="date" id="date" required onchange="calculateTotal()" min="${today}" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="start" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                            <input type="time" id="start" required onchange="calculateTotal()" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                        </div>
                        <div>
                            <label for="end" class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                            <input type="time" id="end" required onchange="calculateTotal()" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2">
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <h3 class="text-2xl font-bold">Total: â‚¹<span id="total" class="text-teal-600">0.00</span></h3>
                        <p id="total-hours-microcopy" class="text-sm text-gray-600"></p>
                        <p id="total-error" class="text-red-500 text-sm mt-1"></p>
                    </div>
                    
                    <button type="button" id="confirm-booking-btn" onclick="confirmBooking()" class="w-full btn-primary font-bold py-3 px-6 rounded-lg text-lg shadow-md" disabled>
                        Confirm Booking
                    </button>
                </form>
            `;
            calculateTotal();
        }

        function calculateTotal() {
            const space = spaces.find(s => s.id === currentSpaceId);
            if (!space) return;
            const startInput = document.getElementById('start').value;
            const endInput = document.getElementById('end').value;
            const totalEl = document.getElementById('total');
            const errorEl = document.getElementById('total-error');
            const microcopyEl = document.getElementById('total-hours-microcopy');
            const confirmBtn = document.getElementById('confirm-booking-btn');

            errorEl.innerText = '';
            totalEl.innerText = '0.00';
            microcopyEl.innerText = '';
            
            if (!confirmBtn) return; 
            confirmBtn.disabled = true;

            if (startInput && endInput) {
                const startTime = new Date(`1970-01-01T${startInput}:00`);
                const endTime = new Date(`1970-01-01T${endInput}:00`);

                if (endTime <= startTime) {
                    errorEl.innerText = 'End time must be after start time.';
                    return;
                }

                const diffHours = (endTime - startTime) / (1000 * 60 * 60);
                const totalCost = diffHours * space.price;
                totalEl.innerText = totalCost.toFixed(2);
                microcopyEl.innerText = `Est. ${diffHours.toFixed(1)} hours`;
                
                if (document.getElementById('date').value) {
                    confirmBtn.disabled = false;
                }
            }
        }

        function confirmBooking() {
            const errorMsgEl = document.getElementById('booking-error-message');
            const successMsgEl = document.getElementById('success-message');
            errorMsgEl.classList.add('hidden');
            
            if (!currentUser) {
                errorMsgEl.innerText = 'You must be logged in to book.';
                errorMsgEl.classList.remove('hidden');
                return;
            }
            
            const date = document.getElementById('date').value;
            const startTime = document.getElementById('start').value;
            const endTime = document.getElementById('end').value;

            if (!date || !startTime || !endTime) {
                errorMsgEl.innerText = 'Please fill in all date and time fields.';
                errorMsgEl.classList.remove('hidden');
                return;
            }
            
            const totalCost = parseFloat(document.getElementById('total').innerText);
            if (totalCost <= 0) {
                errorMsgEl.innerText = 'Please select a valid time range (end time must be after start time).';
                errorMsgEl.classList.remove('hidden');
                return;
            }

            const newBooking = {
                id: Date.now(),
                userId: currentUser.id,
                spaceId: currentSpaceId,
                date,
                startTime,
                endTime,
                totalCost
            };
            bookings.push(newBooking);

            document.getElementById('book-content').classList.add('hidden');
            successMsgEl.classList.remove('hidden');
            
            setTimeout(() => {
                showPage('account');
            }, 2500);
        }


        // 4. Host Page Logic
        
        function checkOtherType(event) {
            const wrapper = document.getElementById('other-type-wrapper');
            const input = document.getElementById('other-type');
            if (event.target.value === 'Other') {
                wrapper.classList.remove('hidden');
                input.required = true; 
            } else {
                wrapper.classList.add('hidden');
                input.required = false;
                input.value = ''; 
            }
        }

        function addSpace(event) {
            event.preventDefault(); 
            
            const hostMsg = document.getElementById('hostMsg');
            hostMsg.classList.add('hidden'); // Hide on new submit
            
            if (!currentUser) {
                 hostMsg.innerText = "Error: You must be logged in.";
                 hostMsg.className = "mt-6 p-4 rounded-xl shadow-soft font-medium bg-red-100 text-red-800";
                 hostMsg.classList.remove('hidden');
                return;
            }
            
            const name = document.getElementById('name').value;
            const location = document.getElementById('location').value;
            const price = parseFloat(document.getElementById('price').value);
            const description = document.getElementById('desc').value;
            
            let type = document.getElementById('type').value;
            if (type === 'Other') {
                type = document.getElementById('other-type').value;
                if (!type || type.trim().length === 0) {
                     hostMsg.innerText = "Error: Please enter a custom type name.";
                     hostMsg.className = "mt-6 p-4 rounded-xl shadow-soft font-medium bg-red-100 text-red-800";
                     hostMsg.classList.remove('hidden');
                    return;
                }
            }
            
            const amenities = document.getElementById('amenities').value
                                        .split(',')
                                        .map(item => item.trim())
                                        .filter(item => item.length > 0);
            
            const images = [
                document.getElementById('preview1').src,
                document.getElementById('preview2').src,
                document.getElementById('preview3').src,
                document.getElementById('preview4').src,
                document.getElementById('preview5').src
            ].filter(src => src && src.startsWith('data:image')); 

            if (images.length === 0) {
                images.push(`https://picsum.photos/seed/${encodeURIComponent(name.split(' ').join(''))}/600/400`);
            }
            
            const newSpace = {
                id: Date.now(),
                hostId: currentUser.id,
                hostName: currentUser.name,
                name: name,
                type: type, 
                price: price,
                location: location,
                images: images,
                description: description || "No description provided.",
                amenities: amenities.length > 0 ? amenities : ["No amenities listed"],
                rating: 0, 
                reviewCount: 0, 
                reviews: [] 
            };
            
            spaces.push(newSpace);
            
            hostMsg.innerText = "âœ… Your space has been listed successfully!";
            hostMsg.className = "mt-6 p-4 rounded-xl shadow-soft font-medium bg-green-100 text-green-800";
            hostMsg.classList.remove('hidden');
            
            document.getElementById('host-form').reset();
            
            document.getElementById('other-type-wrapper').classList.add('hidden');
            
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`preview${i}`).src = "";
                document.getElementById(`text-preview${i}`).classList.remove('hidden');
            }
            
            renderCategoryFilters();

            setTimeout(() => {
                showPage('account');
                showAccountTab('spaces');
            }, 2000);
        }
        
        // 5. Account Page Logic
        function renderAccountPage() {
            if (!currentUser) {
                showPage('login');
                return;
            }
            
            document.getElementById('account-welcome').innerText = `Welcome, ${currentUser.name}!`;
            
            // Render "My Bookings"
            const bookingsContent = document.getElementById('tab-content-bookings');
            const myBookings = bookings.filter(b => b.userId === currentUser.id);
            bookingsContent.innerHTML = '';
            
            if (myBookings.length === 0) {
                bookingsContent.innerHTML = `<p class="text-gray-600">You haven't booked any spaces yet.</p>`;
            } else {
                myBookings.forEach(booking => {
                    const space = spaces.find(s => s.id === booking.spaceId);
                    if (space) {
                        const bookingDate = new Date(booking.date + 'T00:00:00'); 
                        const formattedDate = bookingDate.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                        
                        bookingsContent.innerHTML += `
                            <div class="bg-white rounded-xl shadow-soft p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4">
                                <img src="${space.images[0]}" alt="${space.name}" class="w-full sm:w-32 h-32 object-cover rounded-md flex-shrink-0">
                                <div class="flex-grow">
                                    <h3 class="text-xl font-bold">${space.name}</h3>
                                    <p class="text-gray-600">${space.location}</p>
                                    <p class="text-gray-800 font-semibold mt-2">Date: ${formattedDate}</p>
                                    <p class="text-gray-800 font-semibold">Time: ${booking.startTime} - ${booking.endTime}</p>
                                </div>
                                <div class="w-full sm:w-auto text-left sm:text-right mt-4 sm:mt-0">
                                    <p class="text-lg font-bold text-teal-600">Total: â‚¹${booking.totalCost.toFixed(2)}</p>
                                </div>
                            </div>
                        `;
                    }
                });
            }
            
            // Render "My Spaces"
            const spacesContent = document.getElementById('tab-content-spaces');
            const mySpaces = spaces.filter(s => s.hostId === currentUser.id);
            spacesContent.innerHTML = '';
            
            if (mySpaces.length === 0) {
                spacesContent.innerHTML = `<p class="text-gray-600">You haven't listed any spaces yet.</p>`;
            } else {
                 mySpaces.forEach(space => {
                    spacesContent.innerHTML += `
                        <div class="bg-white rounded-xl shadow-soft p-4 flex flex-col sm:flex-row items-start sm:items-center gap-4">
                            <img src="${space.images[0]}" alt="${space.name}" class="w-full sm:w-32 h-32 object-cover rounded-md flex-shrink-0">
                            <div class="flex-grow">
                                <h3 class="text-xl font-bold">${space.name}</h3>
                                <p class="text-gray-600">${space.location}</p>
                                <div class="flex items-center mt-2">
                                    ${STAR_FILLED_SVG}
                                    <span class="text-gray-700 font-semibold ml-1">${space.rating.toFixed(1)}</span>
                                    <span class="text-gray-500 text-sm ml-2">(${space.reviewCount} reviews)</span>
                                </div>
                            </div>
                            <div class="w-full sm:w-auto mt-4 sm:mt-0">
                                <button onclick="showPage('details', ${space.id})" class="w-full btn-secondary font-semibold py-2 px-4 rounded-xl">View Listing</button>
                            </div>
                        </div>
                    `;
                });
            }
            
            // Ensure first tab is active by default
            showAccountTab('bookings');
        }
        
        function showAccountTab(tabId) {
            document.querySelectorAll('.account-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`tab-content-${tabId}`).classList.remove('hidden');
            document.getElementById(`tab-btn-${tabId}`).classList.add('active');
        }

        // --- INITIALIZATION ---
        window.onload = () => {
            document.body.addEventListener('change', (event) => {
                if(event.target.id === 'date' && document.getElementById('page-book').classList.contains('active')) {
                    calculateTotal();
                }
            });
            
            renderCategoryFilters();
            showPage('home'); 
        };

    </script>
</body>
</html>